{"version":3,"sources":["../../src/bin/Capture.js"],"names":["LOG","DEBUG","test","process","env","NODE_DEBUG","timeout","w","Promise","r","console","log","setTimeout","Capture","wait","file","_file","app","title","delay","resize","colors","on","files","ListStream","WinIdStream","CaptureStream","noShadow","Transform","transform","path","enc","next","push","length","error","stack","message","info","size","all","map","err"],"mappings":";;;;;;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;AATA;AAWA,MAAMA,MAAM,oBAAS,SAAT,CAAZ;AACA,MAAMC,QAAQ,UAAUC,IAAV,CAAeC,QAAQC,GAAR,CAAYC,UAA3B,CAAd;;AAEA,MAAMC,UAAU,MAAOC,CAAP,IAAa;AAC3B,SAAOA,IAAI,CAAX,EAAc;AACZ,UAAM,IAAIC,OAAJ,CAAaC,CAAD,IAAO;AACvBC,cAAQC,GAAR,CAAY,OAAZ,EAAqBJ,CAArB;AACAK,iBAAWH,CAAX,EAAc,IAAd;AACAF;AACD,KAJK,CAAN;AAKD;AACF,CARD;;AAUe,eAAeM,OAAf,CAAuB;AACpCC,MADoC;AAEpCC,QAAMC,KAF8B;AAGpCC,KAHoC;AAIpCC,OAJoC;AAKpCC,OALoC;AAMpCC,QANoC;AAOpCC;AAPoC,CAAvB,EAQZ;AACD,MAAIN,OAAOC,KAAX;;AACA,MAAI,CAACD,IAAL,EAAW;AACTA,WAAO,MAAM,kBAAQ;AAAEE,SAAF;AAAOC;AAAP,KAAR,CAAb;AACD;;AAED,QAAMZ,QAAQQ,IAAR,CAAN;AAEAX,UAAQmB,EAAR,CAAW,QAAX,EAAqB,YAAY;AAC/BrB,YAAQD,IAAI,YAAJ,CAAR,GAA4BU,QAAQC,GAAR,CAAY,sBAAZ,CAA5B;AACD,GAFD;AAIAD,UAAQC,GAAR,CAAY,qCAAZ;AACA,QAAMY,QAAQ,EAAd;AAEA,qBACE,IAAIC,mBAAJ,CAAe;AAAEP,OAAF;AAAOC,SAAP;AAAcC;AAAd,GAAf,CADF,EAEE,IAAIM,gBAAJ,EAFF,EAGE,IAAIC,sBAAJ,CAAkB;AAChBX,QADgB;AAEhBY,cAAU;AAFM,GAAlB,CAHF,EAOE,IAAIC,iBAAJ,CAAc;AACZC,cAAUC,IAAV,EAAgBC,GAAhB,EAAqBC,IAArB,EAA2B;AACzBT,YAAMU,IAAN,CAAY,GAAEH,IAAK,EAAnB;AACApB,cAAQC,GAAR,CAAYY,MAAMW,MAAlB;AACAF;AACD;;AALW,GAAd,CAPF,EAcE,MAAOG,KAAP,IAAiB;AACf,QAAIA,KAAJ,EAAW;AACTlC,cAAQD,IAAImC,MAAMC,KAAV,CAAR,GAA2B1B,QAAQC,GAAR,CAAYwB,MAAME,OAAlB,CAA3B;AACD;;AACDrC,QAAI,KAAJ;AACA,QAAI,CAACuB,MAAMW,MAAX,EAAmB;AAEnB,UAAM,uBAAS;AAAEd,YAAF;AAAUL,UAAV;AAAgBQ,WAAhB;AAAuBJ,WAAvB;AAA8BE;AAA9B,KAAT,CAAN;AACA,UAAMiB,OAAO,mBAAUvB,IAAV,CAAb;AACE,KAACd,QAAQD,GAAR,GAAcU,QAAQC,GAAvB,EAA4B,qBAA5B,EAAmDI,IAAnD,EAAyDuB,KAAKC,IAA9D;AACF,UAAM/B,QAAQgC,GAAR,CAAYjB,MAAMkB,GAAN,CAAU,MAAMX,IAAN,IAAc;AACxC,UAAI;AACF,cAAM,kBAAM;AAAEA;AAAF,SAAN,CAAN;AACA9B,YAAI,WAAJ,EAAiB8B,IAAjB;AACD,OAHD,CAGE,OAAOY,GAAP,EAAY;AACZ1C,YAAI0C,GAAJ;AACD;AACF,KAPiB,CAAZ,CAAN;AAQD,GAhCH;AAkCD","sourcesContent":["/* eslint-disable no-console */\nimport { lstatSync } from 'fs'\nimport { Transform } from 'stream'\nimport { debuglog } from 'util'\nimport { erase } from 'wrote'\nimport pump from 'pump'\nimport { WinIdStream, getFile } from '../lib'\nimport gifsicle from '../lib/gifsicle'\nimport ListStream from '../lib/ListStream'\nimport CaptureStream from '../lib/CaptureStream'\n\nconst LOG = debuglog('appshot')\nconst DEBUG = /appshot/.test(process.env.NODE_DEBUG)\n\nconst timeout = async (w) => {\n  while (w > 0) {\n    await new Promise((r) => {\n      console.log('...%s', w)\n      setTimeout(r, 1000)\n      w--\n    })\n  }\n}\n\nexport default async function Capture({\n  wait,\n  file: _file,\n  app,\n  title,\n  delay,\n  resize,\n  colors,\n}) {\n  let file = _file\n  if (!file) {\n    file = await getFile({ app, title })\n  }\n\n  await timeout(wait)\n\n  process.on('SIGINT', async () => {\n    DEBUG ? LOG('\\nSIGING\\n') : console.log('\\nStopping recording')\n  })\n\n  console.log('Starting recording (ctrl-c to stop)')\n  const files = []\n\n  pump(\n    new ListStream({ app, title, delay }),\n    new WinIdStream,\n    new CaptureStream({\n      file,\n      noShadow: true,\n    }),\n    new Transform({\n      transform(path, enc, next) {\n        files.push(`${path}`)\n        console.log(files.length)\n        next()\n      },\n    }),\n    async (error) => {\n      if (error) {\n        DEBUG ? LOG(error.stack) : console.log(error.message)\n      }\n      LOG('END')\n      if (!files.length) return\n\n      await gifsicle({ resize, file, files, delay, colors })\n      const info = lstatSync(file)\n      ; (DEBUG ? LOG : console.log)('saved %s (%s bytes)', file, info.size)\n      await Promise.all(files.map(async path => {\n        try {\n          await erase({ path })\n          LOG('erased %s', path)\n        } catch (err) {\n          LOG(err)\n        }\n      }))\n    }\n  )\n}\n"],"file":"Capture.js"}